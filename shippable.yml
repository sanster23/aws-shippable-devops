branches:
  only:
    - master

build:

  # http://docs.shippable.com/ci/shippableyml/#ci
  ci:
    # npm mirrors can sometimes be flacky, better to use shippable_retry
    # http://docs.shippable.com/ci/advancedOptions/retry/
    - STATE="$(shipctl get_resource_state "s1_state")"
    - echo $STATE
    - pushd $(shipctl get_resource_state "git_code_repo")
    - echo "${REPOSITORY_URL}"
    - echo "${BASE_BRANCH}"
    - echo "${COMMIT}"
    - echo $SHIPPABLE_COMMIT_RANGE
    # - changes=`git diff --name-only $SHIPPABLE_COMMIT_RANGE | sort -u | awk 'BEGIN {FS="/"} {print $1}' | uniq`
    - changes="$(git diff --name-only $SHIPPABLE_COMMIT_RANGE | sort -u)"
    - echo $changes
    - echo "******\t******\n\n******\t******"
    - git log
    - popd
